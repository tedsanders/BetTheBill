function DinerCtrl(e){function c(e){var t=d3.interpolate(this._current,e);this._current=t(0);return function(e){return u(t(e))}}var t=["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf"];e.showResult=false;e.diners=[{name:"Diner 1",amount:1,id:1},{name:"Diner 2",amount:2,id:2}];e.nextDiner=3;e.total=0;e.showForm=true;e.disableBackButton=true;e.disableRemoveDiner=false;wheelposition=0;e.addDiner=function(){e.diners.push({name:"Diner "+e.nextDiner,amount:0,id:e.nextDiner});e.nextDiner++;e.updateChart();if(1<e.diners.length)e.disableRemoveDiner=false};e.total=function(){var t=0;angular.forEach(e.diners,function(e){t+=e.amount});return Math.ceil(parseFloat(t)*100)/100};e.removeDiner=function(t){if(2==e.diners.length)e.disableRemoveDiner=true;e.diners.splice(t,1);e.updateChart()};e.betBill=function(){e.showForm=false;e.disableBackButton=true;var t=e.total();if(0!=t){var n=Math.random()*t;var r=0;for(var i=0;i<e.diners.length;i++){r+=Math.ceil(100*parseFloat(e.diners[i].amount))/100;if(n<r){e.setLoser(i);break}}var s=document.querySelector("svg");s.removeAttribute("style");wheelposition=wheelposition-wheelposition%360+1440-360*n/t;var o="-webkit-transform: rotate("+wheelposition+"deg);"+"transform: rotate("+wheelposition+"deg);";s.setAttribute("style",o)}if(0==t)e.showNullResult=true;e.disableBackButton=false};e.setLoser=function(t){e.loser=e.diners[t];e.showResult=true};e.goBack=function(){e.showForm=true;e.showResult=false;e.showNullResult=false};e.startOver=function(){window.location.reload()};e.parseAmt=function(e){return Math.ceil(parseFloat(e)*100)/100};var n=function(){var t=new Array;for(var n in e.diners){t.push(e.diners[n].amount)}return t};var r=document.getElementById("pie-chart").offsetWidth,i=r/2,s=1e3,o=d3.layout.pie().sort(null),u=d3.svg.arc().innerRadius(0).outerRadius(i-r/20);var a=d3.select("#pie-chart").append("svg:svg");var f=a.append("svg:g").attr("class","arcGrp");var l=a.append("svg:g").attr("class","lblGroup");e.updateChart=function(){r=document.getElementById("pie-chart").offsetWidth;i=r/2;u=d3.svg.arc().innerRadius(0).outerRadius(i-r/20);a.attr("width",r).attr("height",r);f.attr("transform","translate("+r/2+","+r/2+")");l.attr("transform","translate("+r/2+","+r/2+")");if(0!=e.diners.length){myAmounts=n();if(0==e.total()){for(var h=0;h<myAmounts.length;h++){myAmounts[h]=1}}var p=f.selectAll("path").data(o(n()));p.enter().append("svg:path").attr("stroke","white").attr("stroke-width",.5).attr("fill",function(n,r){return t[(e.diners[r].id-1)%t.length]}).attr("d",u).each(function(e){this._current=e});p.exit().remove();var d=l.selectAll("text").data(o(n()));d.enter().append("svg:text").attr("class","arcLabel").attr("x",i-r/4).attr("y",0).attr("transform",function(e){var t=u.centroid(e);var n=Math.atan(t[1]/t[0])*180/3.1415926;if(t[0]<0){n=n-180}return"rotate("+n+")"}).attr("text-anchor","middle").attr("alignment-baseline","middle").text(function(t,n){return e.diners[n].name}).attr("style",function(e){if(e.data>0){return"font-size: "+r/12+"px;"}else{return"font-size: 0;"}});d.exit().remove();p.data(o(myAmounts));p.attr("fill",function(n,r){return t[(e.diners[r].id-1)%t.length]});p.transition().ease("elastic").duration(s).attrTween("d",c);d.data(o(myAmounts));d.transition().ease("elastic").duration(s).attr("x",i-r/4).attr("y",0).attr("transform",function(e){var t=u.centroid(e);var n=Math.atan(t[1]/t[0])*180/3.1415926;if(t[0]<0){n=n-180}return"rotate("+n+")"}).attr("text-anchor","middle").attr("alignment-baseline","middle").text(function(t,n){return e.diners[n].name}).attr("style",function(e){if(e.data>0){return"font-size: "+r/12+"px;"}else{return"font-size: 0;"}})}};e.updateChart();window.onresize=function(t){e.updateChart()}}var app=angular.module("bet-the-bill",[])
